---
allowed-tools: Task, Read, Edit, MultiEdit, Write, LS, Grep
---

# CodeRabbit 审查处理器

使用上下文感知的判断力处理 CodeRabbit 审查评论。

## 用法
```
/code-rabbit
```

然后粘贴一个或多个 CodeRabbit 评论。

## 指令

### 1. 初始上下文

通知用户：
```
我将谨慎审查 CodeRabbit 评论，因为 CodeRabbit 无法访问整个代码库，可能不了解完整上下文。

对于每个评论，我将：
- 根据我们的代码库上下文评估其有效性
- 接受能提高代码质量的建议
- 忽略不适用于我们架构的建议
- 解释接受/忽略决定的理由
```

### 2. 处理评论

#### 单文件评论
如果所有评论都与一个文件相关：
- 读取文件以了解上下文
- 评估每个建议
- 使用 MultiEdit 批量应用接受的更改
- 报告接受/忽略的建议及原因

#### 多文件评论
如果评论跨越多个文件：

使用 Task 工具启动并行子代理：
```yaml
Task:
  description: "{filename} 的 CodeRabbit 修复"
  subagent_type: "general-purpose"
  prompt: |
    审查并应用 {filename} 的 CodeRabbit 建议。
    
    要评估的评论：
    {relevant_comments_for_this_file}
    
    指令：
    1. 读取文件以了解上下文
    2. 对于每个建议：
       - 根据代码库模式评估有效性
       - 如果能提高质量/正确性则接受
       - 如果不适用则忽略
    3. 使用 Edit/MultiEdit 应用接受的更改
    4. 返回摘要：
       - 接受：{带原因的列表}
       - 忽略：{带原因的列表}
       - 所做更改：{简要描述}
    
    谨慎使用 - CodeRabbit 缺乏完整上下文。
```

### 3. 整合结果

所有子代理完成后：
```
📋 CodeRabbit 审查摘要

处理的文件：{数量}

接受的建议：
  {文件}：{所做的更改}
  
忽略的建议：
  {文件}：{忽略的原因}

总计：{X}/{Y} 个建议已应用
```

### 4. 要忽略的常见模式

- **与项目约定冲突的风格偏好**
- **不适用于我们特定用例的通用最佳实践**
- **对非性能关键代码的性能优化**
- **内部工具的可访问性建议**
- **已验证模式的安全警告**
- **会破坏我们结构的导入重组**

### 5. 要接受的常见模式

- **实际错误**（空值检查、错误处理）
- **安全漏洞**（除非是误报）
- **资源泄漏**（未关闭的连接、内存泄漏）
- **类型安全问题**（TypeScript/类型提示）
- **逻辑错误**（差一错误、错误条件）
- **缺少错误处理**

## 决策框架

对于每个建议，考虑：
1. **是否正确？** - 问题是否确实存在？
2. **是否相关？** - 是否适用于我们的用例？
3. **是否有益？** - 修复是否能改善代码？
4. **是否安全？** - 更改是否可能引入问题？

仅当所有答案都是"是"或收益明显超过风险时才应用。

## 重要说明

- CodeRabbit 很有帮助但缺乏上下文
- 相信您对代码库的理解胜过通用建议
- 简要解释决定以保持审计跟踪
- 批量处理相关更改以提高效率
- 使用并行代理处理多文件审查以节省时间