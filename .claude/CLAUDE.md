# CLAUDE.md

> 仔细思考并实现改变最少代码的最简洁解决方案。

## 使用子代理进行上下文优化

### 1. 要求读取文件时始终使用 file-analyzer 子代理。
file-analyzer 代理是提取和总结文件关键信息的专家，特别是日志文件和详细输出。它提供简洁、可操作的摘要，在大幅减少上下文使用的同时保留基本信息。

### 2. 要求搜索代码、分析代码、研究错误或追踪逻辑流时始终使用 code-analyzer 子代理。

code-analyzer 代理是代码分析、逻辑追踪和漏洞检测的专家。它提供简洁、可操作的摘要，在大幅减少上下文使用的同时保留基本信息。

### 3. 运行测试和分析测试结果时始终使用 test-runner 子代理。

使用 test-runner 代理确保：

- 完整的测试输出被捕获用于调试
- 主对话保持清洁和专注
- 上下文使用得到优化
- 所有问题都得到正确显示
- 没有批准对话框中断工作流程

## 哲学

### 错误处理

- **快速失败** 用于关键配置（缺少文本模型）
- **记录并继续** 用于可选功能（提取模型）
- **优雅降级** 当外部服务不可用时
- **用户友好消息** 通过弹性层

### 测试

- 始终使用 test-runner 代理执行测试。
- 永不使用模拟服务。
- 在当前测试完成之前不要进行下一个测试。
- 如果测试失败，考虑检查测试结构是否正确，然后再决定是否需要重构代码库。
- 测试要详细以便我们用于调试。


## 语气和行为

- 欢迎批评。请告诉我何时我错了或弄错了，或者当你认为我可能错了或弄错了。
- 请告诉我是否有比我采用的方法更好的方法。
- 请告诉我是否有我似乎不知道的相关标准或约定。
- 保持怀疑。
- 保持简洁。
- 简短摘要可以，但在我们详细制定计划时不要给出扩展的分解。
- 不要奉承，除非我特别要求你的判断，否则不要给出赞美。
- 偶尔的客套话可以。
- 可以问很多问题。如果你对我的意图有疑问，不要猜测。问。

## 绝对规则：

- 无部分实现
- 无简化：无"//这是现在的简化内容，完整实现会blablabla"
- 无代码重复：检查现有代码库以重用函数和常量。写新函数前先读取文件。使用常识性的函数名以便轻松找到。
- 无死代码：要么使用要么从代码库中完全删除
- 为每个函数实现测试
- 无作弊测试：测试必须准确，反映实际使用情况并设计用于揭示缺陷。无无用测试！设计测试要详细以便我们用于调试。
- 无不一致命名 - 读取现有代码库命名模式。
- 无过度工程 - 不要添加不必要的抽象、工厂模式或中间件，简单函数就能工作时不要这样做。需要"工作"时不要想"企业级"
- 无混合关注点 - 不要在API处理程序中放置验证逻辑，在UI组件中放置数据库查询等，而应适当分离
- 无资源泄漏 - 不要忘记关闭数据库连接，清除超时，移除事件监听器，或清理文件句柄